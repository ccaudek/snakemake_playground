---
title: "Test Report"
author:
    - "Corrado Caudek"
date: "`r format(Sys.time(), '%d %B, %Y')`"
params:
   rmd: "report.Rmd"
output:
  html_document:
    highlight: tango
  number_sections: no
  theme: default
  toc: yes
  toc_depth: 3
  toc_float:
    collapsed: no
    smooth_scroll: yes
---


```{r}
library("tidyverse")
library("knitr")
```

## A title

This is an R Markdown document.  Here I print the path that is currently used:

```{r}
getwd()
```

This script uses the data subset `r snakemake@input[["subset_data"]]` that has been extracted from `r snakemake@input[["data"]]`.

Let's make a summary of the data:

```{r}
d <- readRDS(snakemake@input[["subset_data"]])
summary(d)
```

Here I generate a plot from the input data:

```{r}
d %>%
    ggplot(
        aes(flipper_length_mm, body_mass_g)
    ) +
    geom_point()
```

### Syntax note

Here I print a path passed through the snakefile object. Here it is:

`r snakemake@input[["table_data"]]`

Note the syntax used in the .smk rule: `rules.save_table.output.tab1`.

### Displaying the content of an external .txt file

I read the address of the file:

```{r}
foo <- snakemake@input[["table_data"]]
foo
```

The address in the object `foo` is enclosed in quotes. This is the argument of the function `readLines()`.  With the following syntax, I get the desired result. The chunk needs the specification `{r comment=''}`:

```{r comment=''}
cat(readLines(foo), sep = '\n')
```

## Include pdf image

### First method

I read the address of the file:

```{r}
foo_fig <- snakemake@input[["fig_pdf"]]
foo_fig
```

If I use the function `knitr::include_graphics()`, the workflow fails! There is a problem with the directory.

```{r eval=FALSE}
knitr::include_graphics(snakemake@input[["fig_pdf"]])
```

### Second method

This method is not perfect, but at least it reads the image:

```{r}
knitr::include_graphics(snakemake@params[["pdf_fig1"]])
```



## Source
<a download="report.Rmd" href="`r base64enc::dataURI(file = params$rmd, mime = 'text/rmd', encoding = 'base64')`">R Markdown source file (to produce this document)</a>
